<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>FlaskApp</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="styles.css">
</head>

<body>

    <button id="submitButton" type="button" class="btn btn-secondary btn-lg btn-block">Send API Request</button>

    <div class="flex-container">
        {% for author in library %}
        {% for book in library[author] %}

        <div class="flex-item">
            <div>
                <div class="img-container">
                    <img src="http://192.168.8.101:8000/{{ author }}/{{ book }}/cover.jpg" alt="{{ book }}" width="250">
                    <input id="{{ author }}/{{ book }}" type="checkbox" {% if (author ~ '/' ~ book) in previously_synced_books %}checked{% endif %} >
                </div>
                
                <div class="desc">
                    <ul>
                        <li class="movie-title">{{ book }}</li>
                        <li class="movie-platform">{{ author }}</li>
                    </ul>
                </div>
            </div>
        </div>

        {% endfor %}
        {% endfor %}
    </div>

    <script>
        // Function to send the API request
        function sendApiRequest(checkedCheckboxes) {
            const apiUrl = '/set';

            fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ checkedCheckboxes }),
            })
                .then(response => {
                    if (response.ok) {
                        console.log('API request sent successfully.');
                    } else {
                        console.error('Failed to send API request.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        // Event listener for the button click
        document.getElementById('submitButton').addEventListener('click', function () {
            const checkedCheckboxes = [];

            // Iterate through the checkboxes to find the checked ones
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                if (checkbox.checked) {
                    checkedCheckboxes.push(checkbox.id);
                }
            });

            // Call the function to send the API request with the checked checkboxes
            sendApiRequest(checkedCheckboxes);
        });

        const imageContainers = document.querySelectorAll('.img-container');
        imageContainers.forEach(container => {
            container.addEventListener('click', () => {
                // Toggle the associated checkbox's state when the container is clicked
                const checkbox = container.querySelector('input[type="checkbox"]');
                checkbox.checked = !checkbox.checked;
            });
        });
    </script>


</body>

</html>